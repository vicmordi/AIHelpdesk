<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Helpdesk - Admin</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="css/admin-layout.css">
</head>
<body>
    <div class="admin-app">
        <div id="admin-overlay" class="admin-overlay" aria-hidden="true"></div>
        <button type="button" class="admin-mobile-menu" id="admin-mobile-menu" aria-label="Open menu">‚ò∞</button>
        <aside class="admin-sidebar" id="admin-sidebar">
            <!-- Sidebar rendered by sidebar.js -->
        </aside>
        <main class="admin-main">
            <div id="error-message" class="alert alert-error" style="display: none;"></div>
            <div id="success-message" class="alert alert-success" style="display: none;"></div>

            <!-- Dashboard page -->
            <section class="admin-page" data-page="dashboard" id="page-dashboard">
                <div class="admin-page-header">
                    <h1>Dashboard</h1>
                    <p class="subtitle">Overview of your helpdesk</p>
                </div>
                <div class="stats-grid" id="dashboard-stats">
                    <div class="stat-card" data-filter="all">
                        <div class="stat-icon">üìã</div>
                        <div class="stat-value" id="stat-total">0</div>
                        <div class="stat-label">All Tickets</div>
                    </div>
                    <div class="stat-card" data-filter="resolved">
                        <div class="stat-icon">‚úÖ</div>
                        <div class="stat-value" id="stat-resolved">0</div>
                        <div class="stat-label">Resolved</div>
                    </div>
                    <div class="stat-card" data-filter="escalated">
                        <div class="stat-icon">‚ö†Ô∏è</div>
                        <div class="stat-value" id="stat-escalated">0</div>
                        <div class="stat-label">Escalated</div>
                    </div>
                    <div class="stat-card" data-filter="in_progress">
                        <div class="stat-icon">üîÑ</div>
                        <div class="stat-value" id="stat-in-progress">0</div>
                        <div class="stat-label">In Progress</div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h2>Quick actions</h2>
                    </div>
                    <div class="card-body" style="display: flex; flex-wrap: wrap; gap: 12px;">
                        <a href="#tickets" class="btn btn-primary">View all tickets</a>
                        <a href="#knowledge-base" class="btn btn-secondary">Knowledge Base</a>
                        <a href="#add-article" class="btn btn-secondary">Add article</a>
                    </div>
                </div>
            </section>

            <!-- Tickets page -->
            <section class="admin-page" data-page="tickets" id="page-tickets">
                <div class="admin-page-header">
                    <h1>Tickets</h1>
                    <p class="subtitle">Manage and filter support tickets</p>
                </div>
                <div class="card">
                    <div class="card-header" style="flex-wrap: wrap; gap: 12px;">
                        <h2 id="tickets-list-title">All Tickets</h2>
                        <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
                            <select id="status-group-filter" class="form-control-inline">
                                <option value="all">All</option>
                                <option value="open">Open</option>
                                <option value="assigned">Assigned</option>
                                <option value="closed">Closed</option>
                            </select>
                            <select id="assigned-to-filter" class="form-control-inline">
                                <option value="">All assignees</option>
                            </select>
                            <input type="search" id="tickets-search" class="form-control-inline" placeholder="Search..." style="min-width: 160px;">
                            <select id="status-filter">
                                <option value="all">All Statuses</option>
                                <option value="pending">Pending</option>
                                <option value="in_progress">In Progress</option>
                                <option value="resolved">Resolved</option>
                                <option value="escalated">Escalated</option>
                                <option value="auto_resolved">Auto-Resolved</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="all-tickets-list" class="tickets-list">
                            <div class="loading">Loading tickets...</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Knowledge Base page (list) -->
            <section class="admin-page" data-page="knowledge-base" id="page-knowledge-base">
                <div class="admin-page-header">
                    <h1>Knowledge Base</h1>
                    <p class="subtitle">Articles used by AI to resolve tickets</p>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h2>Articles</h2>
                        <span class="stat-badge" id="kb-count" style="display: none;">0</span>
                    </div>
                    <div class="card-body">
                        <div id="articles-list" class="articles-list">
                            <div class="loading">Loading articles...</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Add Article page -->
            <section class="admin-page" data-page="add-article" id="page-add-article">
                <div class="admin-page-header">
                    <h1>Add Knowledge Article</h1>
                    <p class="subtitle">Create articles for AI resolution</p>
                </div>
                <div class="card">
                    <div class="card-body">
                        <form id="kb-form">
                            <div class="form-group">
                                <label for="kb-title">Article Title</label>
                                <input type="text" id="kb-title" name="title" required placeholder="Enter article title">
                            </div>
                            <div class="form-group">
                                <label for="kb-content">Article Content</label>
                                <textarea id="kb-content" name="content" rows="10" required placeholder="Enter the article content."></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">Save Article</button>
                        </form>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h2>Recent articles</h2>
                    </div>
                    <div class="card-body">
                        <div id="add-article-list" class="articles-list">
                            <div class="loading">Loading...</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Support Admins page (super_admin only) -->
            <section class="admin-page" data-page="support-admins" id="page-support-admins">
                <div class="admin-page-header">
                    <h1>Support Admins</h1>
                    <p class="subtitle">Manage support admin accounts</p>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h2>Add Support Admin</h2>
                    </div>
                    <div class="card-body">
                        <form id="create-support-admin-form" class="form-inline">
                            <input type="email" id="support-admin-email" placeholder="Email" required>
                            <input type="password" id="support-admin-password" placeholder="Temporary password" required minlength="6">
                            <button type="submit" class="btn btn-primary">Create</button>
                        </form>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h2>Support admins</h2>
                    </div>
                    <div class="card-body">
                        <div id="support-admins-list">
                            <div class="loading">Loading...</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Settings page (super_admin only) -->
            <section class="admin-page" data-page="settings" id="page-settings">
                <div class="admin-page-header">
                    <h1>Settings</h1>
                    <p class="subtitle">Organization and security</p>
                </div>
                <div id="settings-content">
                    <div class="loading">Loading settings...</div>
                </div>
            </section>
        </main>
    </div>

    <!-- Article View/Edit Modal -->
    <div id="article-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2 id="article-modal-title">Knowledge Base Article</h2>
                <button type="button" class="modal-close modal-close-btn" data-modal="article-modal" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="article-view-mode">
                    <div class="form-group">
                        <label>Article Title</label>
                        <div id="article-view-title" class="article-view-text"></div>
                    </div>
                    <div class="form-group">
                        <label>Article Content</label>
                        <div id="article-view-content" class="article-view-text"></div>
                    </div>
                    <div class="form-group">
                        <label>Metadata</label>
                        <div id="article-view-meta" class="article-view-text" style="font-size: 12px; color: var(--text-tertiary);"></div>
                    </div>
                </div>
                <div id="article-edit-mode" style="display: none;">
                    <form id="edit-article-form">
                        <input type="hidden" id="edit-article-id">
                        <div class="form-group">
                            <label for="edit-article-title">Article Title</label>
                            <input type="text" id="edit-article-title" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-article-content">Article Content</label>
                            <textarea id="edit-article-content" rows="12" required></textarea>
                        </div>
                    </form>
                </div>
            </div>
            <div class="modal-footer" id="article-modal-footer">
                <div id="article-view-buttons">
                    <button type="button" id="article-edit-btn" class="btn btn-primary">Edit</button>
                    <button type="button" class="btn btn-secondary modal-close-btn" data-modal="article-modal">Close</button>
                </div>
                <div id="article-edit-buttons" style="display: none;">
                    <button type="button" id="article-cancel-edit-btn" class="btn btn-secondary">Cancel</button>
                    <button type="button" id="article-save-edit-btn" class="btn btn-primary">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Messages Modal -->
    <div id="messages-modal" class="modal-overlay">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h2>Messages</h2>
                <button type="button" class="modal-close modal-close-btn" data-modal="messages-modal" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="messages-tickets-list" class="tickets-list">
                    <div class="loading">Loading messages...</div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary modal-close-btn" data-modal="messages-modal">Close</button>
            </div>
        </div>
    </div>

    <!-- Ticket Detail Modal -->
    <div id="ticket-modal" class="modal-overlay">
        <div class="modal" style="max-width: 900px;">
            <div class="modal-header">
                <h2 id="ticket-modal-title">Ticket Details</h2>
                <button type="button" class="modal-close modal-close-btn" data-modal="ticket-modal" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body" id="ticket-modal-body"></div>
            <div class="message-input-area" id="ticket-message-input" style="display: none;">
                <form id="ticket-message-form" class="message-input-form">
                    <input type="hidden" id="current-ticket-id">
                    <textarea id="ticket-message-text" placeholder="Type your message..." required></textarea>
                    <button type="submit" class="btn btn-primary">Send</button>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary modal-close-btn" data-modal="ticket-modal">Close</button>
            </div>
        </div>
    </div>

    <script src="./config.js"></script>
    <script type="module" src="./admin.js"></script>
</body>
</html>
